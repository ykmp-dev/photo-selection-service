# 写真セレクトサービス 要件定義書

## 1. プロジェクト概要

### 1.1 目的
フォトスタジオにおける写真納品プロセスをデジタル化し、顧客体験の向上と業務効率化を実現する。

### 1.2 ターゲットユーザー
- **スタジオスタッフ**: 撮影後の写真管理・納品業務を行う
- **お客様**: 撮影された写真から好きなカットを選択し、必要に応じて商品を注文する

---

## 2. ビジネスフロー

### 2.1 全体フロー
```
[撮影完了]
    ↓
[スタジオ: 写真アップロード & ギャラリー作成]
    ↓
[お客様: 共有URLにアクセス]
    ↓
[お客様: 写真セレクト（最大30カット）]
    ↓
[お客様: データダウンロード]
    ↓
[お客様: オプション選択画面]
    ├→ 完了（追加注文なし）
    ├→ フォトブック注文 → 決済
    └→ 銀塩アルバム注文
         ├ デザイン選択
         ├ 枚数選択（6〜20カット）
         ├ 30カットから再セレクト
         └ 決済
```

### 2.2 料金プラン（想定）
- **基本プラン**: データ納品（30カットまで選択可能）
- **オプション1**: フォトブック（選択した30カット全て使用）
- **オプション2**: 銀塩アルバム（6〜20カットを厳選）

---

## 3. 機能要件

### 3.1 スタジオ管理画面

#### 3.1.1 写真アップロード機能
- [ ] 複数枚の写真を一括アップロード（ドラッグ&ドロップ対応）
- [ ] 対応フォーマット: JPEG, PNG
- [ ] ファイルサイズ上限: 未定（要検討）
- [ ] プレビュー表示
- [ ] 個別削除機能

#### 3.1.2 ギャラリー管理機能
- [ ] ギャラリー作成（お客様名、撮影日、プラン情報など）
- [ ] パスワード設定（オプション）
- [ ] 公開期限設定（例: 30日間）
- [ ] お客様用共有URL生成
- [ ] ギャラリー一覧表示
- [ ] ギャラリー編集・削除

#### 3.1.3 選択結果確認機能
- [ ] お客様が選択したカットの一覧表示
- [ ] 選択枚数・選択率の統計
- [ ] 選択写真のダウンロード（ZIP）
- [ ] 注文情報の確認（フォトブック、アルバム）

### 3.2 お客様選択画面

#### 3.2.1 認証機能
- [ ] パスワード入力画面（パスワード設定時のみ）
- [ ] エラーメッセージ表示

#### 3.2.2 写真閲覧・選択機能
- [ ] グリッド表示（レスポンシブ対応）
- [ ] 写真の拡大表示（ライトボックス）
- [ ] 選択/解除（タップ/クリック）
- [ ] 選択中の写真に視覚的フィードバック（✓マーク）
- [ ] 選択枚数カウンター表示
- [ ] **最大30カットまでの制限** ⭐️
- [ ] 30カット到達時のアラート表示

#### 3.2.3 ナビゲーション機能
- [ ] キーボードショートカット（←→、Space、Esc）
- [ ] スワイプジェスチャー対応（スマホ）
- [ ] 写真の並び替え（撮影順、選択順など）

#### 3.2.4 ダウンロード機能 ⭐️
- [ ] 選択した写真のダウンロード（ZIP形式）
- [ ] ダウンロード進捗表示
- [ ] ファイル名の命名規則（例: ギャラリー名_連番.jpg）

### 3.3 オプション選択画面 ⭐️

#### 3.3.1 分岐UI
- [ ] 「このまま完了」ボタン
- [ ] 「フォトブックを注文」ボタン
- [ ] 「銀塩アルバムを注文」ボタン
- [ ] 各オプションの説明・サンプル画像表示
- [ ] 価格表示

### 3.4 フォトブック注文画面

#### 3.4.1 確認機能
- [ ] 選択した30カットのプレビュー
- [ ] フォトブックの仕様説明
- [ ] 価格表示
- [ ] 「注文する」ボタン → 決済画面へ

### 3.5 銀塩アルバム注文画面

#### 3.5.1 デザイン選択
- [ ] デザインカタログ表示（複数種類）
- [ ] デザインプレビュー
- [ ] デザイン選択UI

#### 3.5.2 枚数選択
- [ ] 枚数選択（6, 8, 10, 12, 14, 16, 18, 20カット）
- [ ] 枚数に応じた価格表示

#### 3.5.3 写真再選択
- [ ] 30カットから選択した枚数分を再セレクト
- [ ] 選択済みカウンター表示
- [ ] プレビュー機能

#### 3.5.4 確認・注文
- [ ] 選択内容の確認画面
- [ ] 合計金額表示
- [ ] 「注文する」ボタン → 決済画面へ

### 3.6 決済画面

#### 3.6.1 決済機能
- [ ] Stripe連携（または他の決済サービス）
- [ ] クレジットカード決済
- [ ] 注文確認メール送信（お客様 & スタジオ）
- [ ] 注文履歴の保存

---

## 4. 非機能要件

### 4.1 パフォーマンス
- [ ] 写真読み込み時間: 3秒以内（4G回線）
- [ ] 画像最適化（WebP対応、遅延読み込み）
- [ ] ページ遷移: 1秒以内

### 4.2 セキュリティ
- [ ] HTTPS通信
- [ ] パスワードのハッシュ化
- [ ] CSRF対策
- [ ] XSS対策
- [ ] ファイルアップロード時のバリデーション

### 4.3 可用性
- [ ] 稼働率: 99%以上（目標）
- [ ] データバックアップ（日次）
- [ ] エラー監視・ログ記録

### 4.4 互換性
- [ ] 対応ブラウザ: Chrome, Safari, Firefox, Edge（最新版 + 1世代前）
- [ ] スマホ対応: iOS 14+, Android 10+
- [ ] タブレット対応

### 4.5 保守性
- [ ] コードの可読性
- [ ] ドキュメント整備
- [ ] テストカバレッジ（目標: 80%以上）

---

## 5. データ設計（概要）

### 5.1 必要なデータエンティティ

#### Gallery（ギャラリー）
- id: string
- name: string（お客様名など）
- password: string | null
- createdAt: datetime
- expiresAt: datetime
- planType: string（basic, premium など）
- status: string（active, expired, deleted）

#### Photo（写真）
- id: string
- galleryId: string
- fileName: string
- storageUrl: string（実ファイルのURL）
- thumbnailUrl: string
- uploadedAt: datetime
- order: number（表示順）

#### Selection（選択）
- id: string
- galleryId: string
- photoId: string
- selectedAt: datetime

#### Order（注文）
- id: string
- galleryId: string
- orderType: string（photobook, album）
- status: string（pending, paid, processing, completed）
- totalAmount: number
- createdAt: datetime
- paidAt: datetime | null

#### AlbumOrder（アルバム注文詳細）
- id: string
- orderId: string
- designId: string
- photoCount: number
- selectedPhotoIds: string[]

---

## 6. 技術選定（検討中）

### 6.1 ストレージ
**選択肢:**
- **Option A**: Googleドライブ連携
  - Pros: 既存フローと統合、コスト削減
  - Cons: API制限、カスタマイズ性低い

- **Option B**: Supabase Storage
  - Pros: 簡単、無料枠あり、PostgreSQL統合
  - Cons: 容量制限（無料1GB）

- **Option C**: AWS S3 + CloudFront
  - Pros: スケーラブル、高速配信
  - Cons: コスト、設定複雑

**推奨**: Option B（まずはSupabaseで開始、必要に応じてS3へ移行）

### 6.2 バックエンド
- **Supabase**: 認証、DB、Storage、API
- または **Node.js + Express** + PostgreSQL

### 6.3 フロントエンド
- 現在: Pure JavaScript
- 今後検討: React / Next.js（状態管理の複雑化に対応）

### 6.4 決済
- **Stripe**: 国際対応、UIカスタマイズ可能
- または **Square**: 日本市場に強い

### 6.5 ホスティング
- **フロント**: GitHub Pages（現在）→ Vercel / Netlify
- **バックエンド**: Supabase / Railway / Render

---

## 7. 未決定事項・要確認事項

### 7.1 ビジネス要件
- [ ] 基本プランの価格
- [ ] フォトブックの価格・仕様
- [ ] 銀塩アルバムの価格・枚数オプション
- [ ] デザインの種類・パターン
- [ ] ギャラリーの公開期限（デフォルト値）
- [ ] データ保存期間

### 7.2 技術要件
- [ ] アップロード可能な写真の最大枚数
- [ ] 1ファイルあたりの最大サイズ
- [ ] ダウンロードファイルの画質（元画質 or 圧縮）
- [ ] 画像フォーマット（JPEG, WebP, HEIC対応？）
- [ ] 同時アクセス数の想定

### 7.3 運用要件
- [ ] お客様サポート体制（メール、電話、チャット？）
- [ ] 注文後のキャンセルポリシー
- [ ] 返品・交換対応
- [ ] データ削除ポリシー（GDPR対応）

---

## 8. 開発フェーズ計画

### Phase 1: MVP（Minimum Viable Product）
- スタジオ管理画面（基本）
- お客様選択画面（30カット制限）
- ダウンロード機能
- Supabase統合

### Phase 2: オプション機能
- オプション選択画面
- フォトブック注文フロー
- 銀塩アルバム注文フロー
- 決済連携（Stripe）

### Phase 3: 改善・最適化
- パフォーマンス改善
- UX改善（A/Bテスト）
- 管理機能強化（統計、レポート）
- メール通知自動化

---

## 9. 成功指標（KPI）

### 9.1 ビジネス指標
- データプラン購入率
- オプション商品の転換率（CVR）
  - フォトブック注文率
  - 銀塩アルバム注文率
- 平均注文額（AOV）
- 顧客満足度（NPS）

### 9.2 技術指標
- ページ読み込み速度
- エラー発生率
- ダウンタイム
- API応答時間

---

## 10. リスク管理

### 10.1 技術リスク
- **リスク**: ストレージ容量不足
- **対策**: 期限付きで自動削除、S3へ移行

- **リスク**: 大量アクセスによるパフォーマンス低下
- **対策**: CDN導入、キャッシュ戦略

### 10.2 ビジネスリスク
- **リスク**: 決済エラーによる機会損失
- **対策**: 複数決済手段の用意、エラー通知

- **リスク**: お客様の選択データ消失
- **対策**: 定期バックアップ、冗長化

---

## 変更履歴
- 2025-12-05: 初版作成
